<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>ğŸ” KriptoServer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1 class="title">ğŸ–¥ï¸ Kriptoloji Sunucu Paneli</h1>

    {% if not started %}
      <div class="form-card">
        <form method="post">
          <div class="field">
            <label>IP Adresi:</label>
            <input type="text" name="ip" value="127.0.0.1" required>
          </div>

          <div class="field">
            <label>Port:</label>
            <input type="number" name="port" value="6000" required>
          </div>

          <button type="submit" class="btn-send">ğŸš€ Server BaÅŸlat</button>
        </form>
      </div>
    {% else %}
      <div class="info-card">
        <p><strong>Server Ã§alÄ±ÅŸÄ±yor:</strong> {{ ip }} : {{ port }}</p>
      </div>

      <div class="form-card">
        <h3>ğŸ“¤ Clientâ€™a Mesaj GÃ¶nder</h3>
        <form id="sendForm">
          <input type="text" name="ip" value="127.0.0.1" hidden>
          <input type="number" name="port" value="6001" hidden>
          <input type="text" name="message" placeholder="GÃ¶nderilecek mesaj..." required>
          <button type="submit" class="btn-send">ğŸ“¡ GÃ¶nder</button>
        </form>
      </div>

      <div class="history-section">
        <div class="history-header">
          <h3>ğŸ“¥ Mesaj GeÃ§miÅŸi</h3>
          <button id="clearBtn" class="btn-clear">ğŸ§¹ Temizle</button>
        </div>

        <div class="history-box" id="messageBox"></div>
      </div>
    {% endif %}
  </div>

  <script>
    async function loadMessages() {
      const res = await fetch("/messages");
      const data = await res.json();
      const box = document.getElementById("messageBox");
      if (!box) return;
      box.innerHTML = "";
      data.forEach(msg => {
        const div = document.createElement("div");
        div.classList.add("message");
        const dir = msg.direction === "Client â†’ Server" ? "ğŸŸ¢" : "ğŸ”µ";
        div.innerHTML = `
          <strong>${dir} ${msg.direction}</strong><br>
          <small>Algoritma:</small> ${msg.algorithm}<br>
          <small>Åifreli:</small> ${msg.encrypted}<br>
          <small>Ã‡Ã¶zÃ¼lmÃ¼ÅŸ:</small> <span class="dec">${msg.decrypted}</span>
        `;
        box.appendChild(div);
      });
    }

    async function clearMessages() {
      await fetch("/clear", { method: "POST" });
      document.getElementById("messageBox").innerHTML = "";
    }

    async function sendMessage(e) {
      e.preventDefault();
      const form = document.getElementById("sendForm");
      const data = new FormData(form);
      const res = await fetch("/send", { method: "POST", body: data });
      const result = await res.json();
      alert(result.success ? "Mesaj gÃ¶nderildi!" : "GÃ¶nderim hatasÄ±!");
    }

    document.getElementById("clearBtn")?.addEventListener("click", clearMessages);
    document.getElementById("sendForm")?.addEventListener("submit", sendMessage);
    setInterval(loadMessages, 2000);
    loadMessages();
  </script>
</body>
</html>
